{% extends 'common/base.html' %}

{% block title %}KSJ's Amazing Game Deals{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ksj-css/ksj.css') }}">
{% endblock %}


{% block content %}
<div class="container mt-5">
    <!-- 타임딜 배너 -->
    <div class="mb-4">
        <a href="/ksj/timedeal">
            <img src="{{ url_for('static', filename='images/timedeal_banner.jpg') }}" class="img-fluid w-100" alt="Time Deal Banner">
        </a>
    </div>

    <h1 class="text-center mb-4">기본게임할인페이지</h1>
    <p class="text-center text-muted">Discover amazing discounts on your favorite games and save big.</p>

    <!-- 필터 -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <span class="fw-bold">Filter by:</span>
        </div>
        <select id="filter" class="form-select w-auto">
            <option value="high" {% if filter_type == 'high' %}selected{% endif %}>Highest Discount</option>
            <option value="low" {% if filter_type == 'low' %}selected{% endif %}>Lowest Discount</option>
        </select>
    </div>

    <!-- 게임 리스트 -->
    <div class="row row-cols-1 row-cols-md-4 g-4">
        {% if games|length > 0 %}
            {% for game in games %}
            <div class="col">
                <div class="card h-100">
                    <img src="{{ game.image_url }}" class="card-img-top" alt="{{ game.name }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ game.name }}</h5>
                        <p class="card-text">
                            <span class="text-danger">{{ game.final_price }}원</span>
                            {% if game.original_price %}
                            <span class="text-muted"><s>{{ game.original_price }}원</s></span>
                            {% endif %}
                        </p>
                        <p class="card-text text-success">{{ game.discount_percent }}% Off</p>
                        <a href="https://store.steampowered.com/app/{{ game.id }}" class="btn btn-primary btn-sm" target="_blank">View on Steam</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col">
                <p class="text-center text-muted">No games available right now. Check back later for more deals!</p>
            </div>
        {% endif %}
    </div>

    <!-- 페이지네이션 -->
    <div class="d-flex justify-content-center mt-4">
        <nav>
            <ul class="pagination">
                <!-- 이전 버튼 -->
                {% if current_page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?filter={{ filter_type }}&page={{ current_page - 1 }}">&laquo;</a>
                </li>
                {% endif %}

                <!-- 페이지 번호 -->
                {% for page_num in range(1, total_pages + 1) %}
                <li class="page-item {% if page_num == current_page %}active{% endif %}">
                    <a class="page-link" href="?filter={{ filter_type }}&page={{ page_num }}">{{ page_num }}</a>
                </li>
                {% endfor %}

                <!-- 다음 버튼 -->
                {% if current_page < total_pages %}
                <li class="page-item">
                    <a class="page-link" href="?filter={{ filter_type }}&page={{ current_page + 1 }}">&raquo;</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>

<script>
    // 필터 변경 시 페이지 이동
    document.getElementById('filter').addEventListener('change', function () {
        const filter = this.value;
        window.location.href = `?filter=${filter}&page=1`;
    });
</script>
{% endblock %}
